# .github/workflows/ci-only.yml
name: CI for ASP.NET Core

# KÃ­ch hoáº¡t pipeline khi cÃ³ push hoáº·c pull request lÃªn nhÃ¡nh main
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# Biáº¿n mÃ´i trÆ°á»ng dÃ¹ng chung cho toÃ n bá»™ job
env:
  PROJECT_PATH: WebLuuFile/WebLuuFile.csproj   # ÄÆ°á»ng dáº«n tá»›i file dá»± Ã¡n .NET
  IMAGE_NAME: dfw345r/webluufile    # TÃªn Docker image sáº½ build

jobs:
  build:
    runs-on: ubuntu-latest   # Cháº¡y trÃªn runner Ubuntu má»›i nháº¥t

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3
        # Láº¥y toÃ n bá»™ mÃ£ nguá»“n tá»« repository vá» mÃ¡y áº£o runner

      - name: ğŸ§° Setup .NET Core SDK
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'
        # CÃ i Ä‘áº·t .NET SDK phiÃªn báº£n 8.0 Ä‘á»ƒ build/publish

      - name: ğŸ› ï¸ Restore dependencies
        run: dotnet restore ${{ env.PROJECT_PATH }}
        # Táº£i táº¥t cáº£ gÃ³i NuGet cáº§n thiáº¿t cho dá»± Ã¡n

      - name: ğŸ—ï¸ Build project
        run: dotnet build ${{ env.PROJECT_PATH }} --configuration Release
        # BiÃªn dá»‹ch dá»± Ã¡n á»Ÿ cáº¥u hÃ¬nh Release, kiá»ƒm tra lá»—i compile

      - name: ğŸ“¦ Publish project
        run: dotnet publish ${{ env.PROJECT_PATH }} -c Release -o publish
        # Xuáº¥t báº£n (publish) thÃ nh thÆ° má»¥c ./publish, sáºµn sÃ ng cho deploy

      - name: ğŸ³ Build Docker image
        run: docker build -t ${{ env.IMAGE_NAME }}:latest .
        # DÃ¹ng Dockerfile Ä‘á»ƒ Ä‘Ã³ng gÃ³i á»©ng dá»¥ng vÃ o image, gáº¯n tag â€œlatestâ€

      - name: ğŸ” Login DockerHub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKERHUB_USER }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
        # ÄÄƒng nháº­p vÃ o Docker Hub báº±ng thÃ´ng tin bÃ­ máº­t lÆ°u trong GitHub Secrets

      - name: ğŸš€ Push Docker image
        run: docker push ${{ env.IMAGE_NAME }}:latest
        # Äáº©y image vá»«a build lÃªn Docker Hub Ä‘á»ƒ lÆ°u trá»¯ hoáº·c deploy sau nÃ y
